
resource "criteria" "gotest" {
    spec {
        input "release_id" {
            type = string
            default = "1"
        }

        // TODO: how to get specific test_run... e.g.:
        // release(filter_on: true, _id: "${self.input.release_id}") {
        //     project(filter_on: true, name: "bubbly") {
        //         name
        //     }
        // }
        query = <<EOT
            {
                test_run(limit: 1) {
                    result
                }
            }
        EOT
        condition "no_test_run" {
            message = "no test run found"
            value = length(self.query.value.test_run) == 1
        }
        
        condition "test_run_pass" {
            message = "test run failed"
            value = self.query.value.test_run[0].result == true
        }
    }
}

// resource "run" "gotest-criteria" {
//     spec {
//         resource = "criteria/gotest"
//     }
// }
